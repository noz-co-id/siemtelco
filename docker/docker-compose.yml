version: "3.9"

############################
# NETWORK DEFINITIONS
############################
networks:
  rf-net:
    internal: true
  ran-net:
    internal: true
  core-net:
    internal: true
  siem-net:
    internal: true

############################
# SERVICES
############################
services:

  ############################
  # UE EMULATORS (RF ONLY)
  ############################
  ue-gsm:
    build: ./docker/ue/osmocombb
    container_name: ue-gsm
    privileged: true
    devices:
      - /dev/bus/usb
    networks:
      - rf-net
    restart: unless-stopped

  ue-lte:
    build: ./docker/ue/srsue
    container_name: ue-lte
    privileged: true
    devices:
      - /dev/bus/usb
    networks:
      - rf-net
    restart: unless-stopped

  ############################
  # RADIO ACCESS NETWORK
  ############################
  ran-gsm:
    build: ./docker/ran/openbts
    container_name: ran-gsm
    privileged: true
    devices:
      - /dev/bus/usb
    networks:
      - rf-net
      - ran-net
    restart: unless-stopped

  ran-lte:
    build: ./docker/ran/srsran
    container_name: ran-lte
    privileged: true
    devices:
      - /dev/bus/usb
    networks:
      - rf-net
      - ran-net
    restart: unless-stopped

  ############################
  # CORE NETWORK
  ############################
  core-2g:
    build: ./docker/core/osmocom
    container_name: core-2g
    networks:
      - ran-net
      - core-net
    restart: unless-stopped

  core-45g:
    build: ./docker/core/open5gs
    container_name: core-45g
    networks:
      - ran-net
      - core-net
    restart: unless-stopped

  ############################
  # SIEM & BEHAVIOR PIPELINE
  ############################
  siemtelco:
    build: ./docker/siem
    container_name: siemtelco
    networks:
      - core-net
      - siem-net
    volumes:
      - ./output:/data
    restart: unless-stopped

############################
# GLOBAL POLICIES
############################
x-offline-policy: &offline
  network_mode: none
